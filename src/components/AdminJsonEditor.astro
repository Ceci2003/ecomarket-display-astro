---
interface Props {
  filename: string;
  content: string;
}

const { filename, content } = Astro.props;
---

<div class="json-editor">
  <h3>{filename}</h3>
  <textarea 
    id={`editor-${filename}`} 
    class="json-textarea"
    data-filename={filename}
  >{content}</textarea>
  <div class="editor-actions">
    <button class="btn btn-save" data-filename={filename}>
      Save Changes
    </button>
    <button class="btn btn-validate" data-filename={filename}>
      Validate JSON
    </button>
    <span class="status-message" id={`status-${filename}`}></span>
  </div>
</div>

<script>
  const editors = document.querySelectorAll('.json-textarea');
  
  editors.forEach((editor) => {
    const filename = editor.getAttribute('data-filename');
    const saveBtn = document.querySelector(`.btn-save[data-filename="${filename}"]`);
    const validateBtn = document.querySelector(`.btn-validate[data-filename="${filename}"]`);
    const statusMsg = document.getElementById(`status-${filename}`);
    
    if (validateBtn && statusMsg) {
      validateBtn.addEventListener('click', () => {
        try {
          JSON.parse(editor.value);
          statusMsg.textContent = '✓ Valid JSON';
          statusMsg.className = 'status-message success';
        } catch (e) {
          statusMsg.textContent = `✗ Invalid JSON: ${e.message}`;
          statusMsg.className = 'status-message error';
        }
      });
    }
    
    if (saveBtn && statusMsg) {
      saveBtn.addEventListener('click', async () => {
        try {
          // Validate first
          JSON.parse(editor.value);
          
          // In a real application, this would send to a server endpoint
          // For now, we'll just show a success message
          statusMsg.textContent = '✓ Changes saved (simulated - implement server endpoint)';
          statusMsg.className = 'status-message success';
          
          // Store in localStorage as backup
          localStorage.setItem(`admin_${filename}`, editor.value);
        } catch (e) {
          statusMsg.textContent = `✗ Cannot save: ${e.message}`;
          statusMsg.className = 'status-message error';
        }
      });
    }
  });
</script>

<style>
  .json-editor {
    margin-bottom: 2rem;
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 1.5rem;
    background-color: var(--color-card-background);
  }

  .json-editor h3 {
    margin-bottom: 1rem;
    color: var(--color-primary);
  }

  .json-textarea {
    width: 100%;
    min-height: 300px;
    padding: 1rem;
    border: 1px solid var(--color-border);
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    background-color: var(--color-background);
    color: var(--color-text);
    resize: vertical;
  }

  .editor-actions {
    display: flex;
    gap: 1rem;
    align-items: center;
    margin-top: 1rem;
  }

  .btn-save,
  .btn-validate {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 500;
  }

  .btn-save {
    background-color: var(--color-primary);
    color: white;
  }

  .btn-validate {
    background-color: var(--color-secondary);
    color: white;
  }

  .status-message {
    padding: 0.5rem 1rem;
    border-radius: 4px;
    font-size: 0.9rem;
  }

  .status-message.success {
    background-color: #d4edda;
    color: #155724;
  }

  .status-message.error {
    background-color: #f8d7da;
    color: #721c24;
  }
</style>

